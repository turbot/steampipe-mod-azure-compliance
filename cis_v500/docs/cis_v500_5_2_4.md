## Description

A Conditional Access policy can be enabled to ensure that users are required to use Multifactor Authentication (MFA) to login.

## Rationale

Conditional Access policies allow for more granular control over when and how MFA is required compared to security defaults or per-user MFA. With Conditional Access, organizations can:
- Require MFA for all users or specific groups
- Require MFA based on risk level
- Require MFA for specific applications
- Require MFA when accessing from untrusted locations
- Exclude emergency access accounts

A baseline Conditional Access policy requiring MFA for all users provides a foundational security control that protects against password-based attacks and unauthorized access.

## Audit

**From Azure Portal:**

1. From Azure Home open the portal menu in the top left, and select `Microsoft Entra ID`
2. Select `Security`
3. Select `Conditional Access`
4. Review policies to identify an MFA policy that covers all users
5. For an appropriate MFA policy, verify:
   - **Assignments > Users**: Should include `All users` (or all users except emergency access accounts)
   - **Assignments > Cloud apps or actions**: Should include `All cloud apps`
   - **Access controls > Grant**:
     - `Grant access` should be selected
     - `Require multi-factor authentication` should be checked
   - **Enable policy**: Should be `On`

**From PowerShell:**

```powershell
Connect-AzureAD
$policies = Get-AzureADMSConditionalAccessPolicy
foreach ($policy in $policies) {
    if ($policy.Conditions.Users.IncludeUsers -contains "All" -and
        $policy.GrantControls.BuiltInControls -contains "mfa") {
        Write-Host "MFA policy found for all users: $($policy.DisplayName)"
        Write-Host "Policy State: $($policy.State)"
    }
}
```

**From Azure CLI:**

```bash
az rest --method GET --uri https://graph.microsoft.com/v1.0/identity/conditionalAccess/policies --query "value[?contains(grantControls.builtInControls, 'mfa')].{Name:displayName, State:state}"
```

## Remediation

**From Azure Portal:**

1. From Azure Home open the portal menu in the top left, and select `Microsoft Entra ID`
2. Select `Security`
3. Select `Conditional Access`
4. Click `+ New policy`
5. Enter a name for the policy (e.g., "Require MFA for all users")
6. Under **Assignments**:
   - **Users**:
     - Include: `All users`
     - Exclude: Select your emergency access/break-glass accounts
   - **Cloud apps or actions**:
     - Select `All cloud apps`
7. Under **Access controls > Grant**:
   - Select `Grant access`
   - Check `Require multi-factor authentication`
   - For multiple controls: Select `Require one of the selected controls` or `Require all the selected controls` as appropriate
8. Set **Enable policy** to `Report-only` initially to test impact
9. After validating, set **Enable policy** to `On`
10. Click `Create`

**Important Notes:**
- Always exclude emergency access accounts from MFA requirements
- Test with Report-only mode first
- Ensure users have registered for MFA before enforcing the policy
- Consider user impact and communication before deployment
- If Security Defaults are enabled, they must be disabled before creating Conditional Access policies

## Default Value

By default, no Conditional Access policies are configured. Organizations must manually create these policies.

## References

- [Conditional Access: Require MFA for all users](https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/howto-conditional-access-policy-all-users-mfa)
- [Building a Conditional Access policy](https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/concept-conditional-access-policies)
- [Plan a Conditional Access deployment](https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/plan-conditional-access)

