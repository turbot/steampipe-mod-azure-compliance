## Description

Restrict default network access to storage accounts to prevent unauthorized access. Use network rules to grant access only to specific networks.

By default, storage accounts accept connections from clients on any network. To limit access to selected networks, you must first change the default action to deny. Network rules can then be configured to grant access from specific Azure virtual networks or public internet IP address ranges.

## Remediation

### From Azure Portal

1. Go to `Storage Accounts`.
2. For each storage account, under `Security + networking`, click `Networking`.
3. Under `Firewalls and virtual networks`, select `Enabled from selected virtual networks and IP addresses`.
4. Under `Default action`, ensure it is set to `Deny`.
5. Add necessary virtual networks or IP ranges under `Virtual networks` or `Firewall`.
6. Click `Save`.

### From Azure CLI

```bash
az storage account update --name <storage-account> --resource-group <resource-group> --default-action Deny
```

To add a network rule:

```bash
az storage account network-rule add --account-name <storage-account> --resource-group <resource-group> --vnet-name <vnet-name> --subnet <subnet-name>
```

### From PowerShell

```bash
Update-AzStorageAccountNetworkRuleSet -ResourceGroupName <resource-group> -Name <storage-account> -DefaultAction Deny
```

To add a network rule:

```bash
Add-AzStorageAccountNetworkRule -ResourceGroupName <resource-group> -Name <storage-account> -VirtualNetworkResourceId <vnet-subnet-id>
```

### Default Value

By default, the default action is set to `Allow`.

