## Description

Customer-managed keys introduce additional depth to security by providing a means to manage access control for encryption keys. Where compliance and security frameworks indicate the need, and organizational capacity allows, sensitive data at rest can be encrypted using customer-managed keys (CMK) rather than Microsoft-managed keys.

## Remediation

**Remediate from Azure Portal**

1. Go to `Monitor`.
2. Select `Activity log.`
3. Select `Export Activity Logs.`
4. Select a `Subscription`.
5. Note the name of the `Storage Account` for the diagnostic setting.
6. Navigate to `Storage accounts.`
7. Click on the storage account.
8. Under `Security + networking`, click `Encryption`.
9. Next to `Encryption type`, select `Customer-managed keys.`
10. Complete the steps to configure a customer-managed key for encryption of the storage account.

**Remediate from Azure CLI**

```bash
az storage account update --name <name of the storage account> --resourcegroup <resource group for a storage account> --encryption-keysource=Microsoft.Keyvault --encryption-key-vault <Key Vault URI> --
encryption-key-name <KeyName> --encryption-key-version <Key Version>
```

**Remediate from PowerShell**

```bash
Set-AzStorageAccount -ResourceGroupName <resource group name> -Name <storageaccount name> -KeyvaultEncryption -KeyVaultUri <key vault URI> -KeyName <keyname>
```

## Default Value

By default, encryption type is set to Microsoft-managed keys.
