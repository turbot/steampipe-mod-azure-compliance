## Description

The account lockout threshold determines how many failed login attempts are permitted prior to placing the account in a locked-out state and initiating a variable lockout duration.

## Rationale

The account lockout threshold is a critical security control that protects against brute-force password attacks. By limiting the number of failed sign-in attempts before locking the account, you can:
- Prevent automated password-guessing attacks
- Slow down brute-force attempts significantly
- Detect potential account compromise attempts
- Force attackers to move more slowly or give up
- Create audit trails of suspicious activity

Setting the threshold too high (or disabling it entirely) leaves accounts vulnerable to brute-force attacks. Setting it too low may cause legitimate users to lock themselves out frequently, leading to:
- Increased help desk calls
- User frustration
- Potential denial of service if attackers deliberately lock accounts

A threshold of 10 or fewer attempts provides a good balance between security and usability. It allows for occasional legitimate mistakes (mistyped passwords) while still preventing brute-force attacks.

## Audit

**From Azure Portal:**

1. From Azure Home open the portal menu in the top left, and select `Microsoft Entra ID`
2. Select `Security`
3. Select `Authentication methods`
4. Select `Password protection`
5. Under `Custom smart lockout`, check the `Lockout threshold` setting
6. Verify that it is set to `10` or less

**From PowerShell:**

```powershell
Connect-MsolService

# Note: This requires the MSOnline module
Get-MsolPasswordPolicy -DomainName <your-domain.com>
```

**Note:** Password protection and smart lockout are premium features available with Azure AD Premium P1 or P2 licensing.

## Remediation

**From Azure Portal:**

1. From Azure Home open the portal menu in the top left, and select `Microsoft Entra ID`
2. Select `Security`
3. Select `Authentication methods`
4. Select `Password protection`
5. Under `Custom smart lockout`:
   - Set `Lockout threshold` to `10` or less (recommended: 5-10)
   - Configure `Lockout duration in seconds` appropriately (see recommendation 5.7)
6. Click `Save`

**From PowerShell:**

```powershell
Connect-MsolService

# Set password policy for domain
Set-MsolPasswordPolicy -DomainName <your-domain.com> -ValidityPeriod <days> -NotificationDays <days>
```

**Note:** The full configuration of smart lockout threshold requires Azure AD Premium licensing and may need to be configured through the Azure portal or Microsoft Graph API.

**From Microsoft Graph API:**

```bash
# This requires appropriate Graph API permissions
# Configure Smart Lockout settings
az rest --method PATCH \
  --uri "https://graph.microsoft.com/beta/settings" \
  --headers "Content-Type=application/json" \
  --body '{
    "values": [{
      "name": "LockoutThreshold",
      "value": "10"
    }]
  }'
```

**Best Practices:**

- Set threshold between 5-10 failed attempts
- Combine with lockout duration (see recommendation 5.7)
- Enable Smart Lockout to distinguish between legitimate users and attackers
- Monitor sign-in logs for lockout events
- Ensure users know how to use password reset if locked out
- Consider using Conditional Access policies for additional protection

**Smart Lockout Benefits:**

Azure AD Smart Lockout uses machine learning to distinguish between legitimate users and attackers:
- Remembers the last three bad password hashes
- Doesn't increment lockout counter for repeated same incorrect password
- Uses sign-in location and patterns to differentiate users from attackers

## Default Value

By default, Smart Lockout is enabled with:
- Lockout threshold: 10 failed attempts
- Lockout duration: 60 seconds

While this is compliant, organizations may want to adjust based on their risk tolerance.

## References

- [Protect user accounts from attacks with Azure Active Directory smart lockout](https://docs.microsoft.com/en-us/azure/active-directory/authentication/howto-password-smart-lockout)
- [Azure AD Password Protection](https://docs.microsoft.com/en-us/azure/active-directory/authentication/concept-password-ban-bad)
- [Password policies and account restrictions in Azure Active Directory](https://docs.microsoft.com/en-us/azure/active-directory/authentication/concept-sspr-policy)

