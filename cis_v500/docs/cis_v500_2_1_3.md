## Description

Traffic between cluster worker nodes should be encrypted to protect data in transit within the Databricks cluster.

## Rationale

By default, communication between worker nodes in a Databricks cluster is not encrypted. Encrypting inter-node traffic:
- Protects sensitive data during shuffle operations
- Prevents eavesdropping on internal cluster communications
- Meets compliance requirements for data encryption in transit
- Provides defense-in-depth security

This is particularly important when processing sensitive data that may be shuffled between nodes during distributed processing operations.

## Audit

**From Azure Portal:**

This setting is configured at the cluster level and must be verified in the cluster configuration.

1. Go to `Azure Databricks`
2. Click on the workspace
3. Click `Launch Workspace`
4. Go to `Compute` in the Databricks workspace
5. For each cluster, click on the cluster name
6. Click `Edit`
7. Expand `Advanced Options`
8. Under `Spark Config`, verify that the following configuration is present:
   ```
   spark.ssl.enabled true
   spark.ssl.protocol TLSv1.2
   ```

**From Databricks CLI:**

```bash
databricks clusters get --cluster-id <cluster-id> | jq '.spark_conf'
```

## Remediation

**From Databricks Workspace:**

1. Go to the Databricks workspace
2. Navigate to `Compute`
3. For each cluster, click on the cluster name
4. Click `Edit`
5. Expand `Advanced Options`
6. Under `Spark Config`, add the following configurations:
   ```
   spark.ssl.enabled true
   spark.ssl.protocol TLSv1.2
   ```
7. Click `Confirm` to save the changes
8. Restart the cluster for the changes to take effect

**From Cluster Policy:**

To enforce this across all clusters, create a cluster policy:

1. In Databricks workspace, go to `Settings` > `Admin Console`
2. Click `Cluster Policies`
3. Create or edit a policy
4. Add the following to enforce encryption:
   ```json
   {
     "spark_conf.spark.ssl.enabled": {
       "type": "fixed",
       "value": "true"
     },
     "spark_conf.spark.ssl.protocol": {
       "type": "fixed",
       "value": "TLSv1.2"
     }
   }
   ```

## References

- [Spark Security](https://spark.apache.org/docs/latest/security.html)
- [Azure Databricks cluster configuration](https://docs.microsoft.com/en-us/azure/databricks/clusters/configure)

