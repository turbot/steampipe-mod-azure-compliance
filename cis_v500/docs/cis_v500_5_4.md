## Description

Require administrators or appropriately delegated users to create new tenants.

## Rationale

By default, all users in a Microsoft Entra ID tenant can create new tenants. This capability should be restricted to prevent:
- Unauthorized creation of tenants that bypass organizational controls
- Shadow IT scenarios where departments create their own tenants
- Potential data exfiltration through unauthorized tenants
- Licensing and cost management issues
- Security policy violations in unmanaged tenants
- Difficulty in maintaining governance across multiple tenants

Only designated administrators or specifically authorized users should have the ability to create new tenants. This ensures:
- Proper oversight and approval for tenant creation
- Consistent application of security policies across all tenants
- Better cost management and licensing control
- Reduced risk of data sprawl
- Centralized management and governance

## Audit

**From Azure Portal:**

1. From Azure Home open the portal menu in the top left, and select `Microsoft Entra ID`
2. Select `Users`
3. Select `User settings`
4. Under `Default user permissions`, check the setting for `Users can create tenants`
5. Verify that it is set to `No`

**From PowerShell:**

```powershell
Connect-AzureAD
$policy = Get-AzureADMSAuthorizationPolicy
Write-Host "Users can create tenants: $($policy.DefaultUserRolePermissions.AllowedToCreateTenants)"
```

If the result is `False`, the setting is correctly configured.

**From Azure CLI:**

```bash
az rest --method GET --uri "https://graph.microsoft.com/v1.0/policies/authorizationPolicy" --query "defaultUserRolePermissions.allowedToCreateTenants"
```

Should return `false`.

## Remediation

**From Azure Portal:**

1. From Azure Home open the portal menu in the top left, and select `Microsoft Entra ID`
2. Select `Users`
3. Select `User settings`
4. Under `Default user permissions`, find `Users can create tenants`
5. Set this to `No`
6. Click `Save`

**Note:** After making this change, only users with the Tenant Creator role or Global Administrator role will be able to create new tenants.

**From PowerShell:**

```powershell
Connect-AzureAD

# Get current authorization policy
$policy = Get-AzureADMSAuthorizationPolicy

# Update to prevent non-admin users from creating tenants
$policy.DefaultUserRolePermissions.AllowedToCreateTenants = $false
Set-AzureADMSAuthorizationPolicy -Id $policy.Id -DefaultUserRolePermissions $policy.DefaultUserRolePermissions

Write-Host "Users can no longer create tenants"
```

**From Microsoft Graph API:**

```bash
# Using Azure CLI with Graph API
az rest --method PATCH \
  --uri "https://graph.microsoft.com/v1.0/policies/authorizationPolicy/authorizationPolicy" \
  --headers "Content-Type=application/json" \
  --body '{"defaultUserRolePermissions":{"allowedToCreateTenants":false}}'
```

**Important Considerations:**

- After implementing this restriction, establish a process for requesting new tenant creation
- Document which users or roles should have the Tenant Creator role
- Monitor tenant creation activities through audit logs
- Ensure emergency access procedures are in place

## Default Value

By default, `Users can create tenants` is set to `Yes`, allowing all users to create new tenants.

## References

- [Restrict tenant creation in Azure Active Directory](https://docs.microsoft.com/en-us/azure/active-directory/roles/permissions-reference#tenant-creator)
- [Default user permissions in Azure AD](https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/users-default-permissions)
- [Manage authorization policies in Azure AD](https://docs.microsoft.com/en-us/graph/api/resources/authorizationpolicy)

