## Description

This recommendation is only relevant if your subscription is using Per-User MFA. If your organization is licensed to use Conditional Access, the preferred method of requiring MFA to join devices to Entra ID is to use a Conditional Access policy (see additional information below for link).

## Rationale

Device registration in Microsoft Entra ID allows devices to be managed and integrated with your organization's identity and access management. When users register or join devices to Entra ID, those devices can:
- Access organizational resources
- Receive configuration policies
- Be used for device-based Conditional Access
- Access company applications and data
- Potentially bypass certain security controls

Requiring multi-factor authentication (MFA) for device registration provides several critical security benefits:

**Enhanced device registration security:**
- Verifies the identity of the person registering the device
- Prevents unauthorized device registration
- Adds protection against stolen credentials being used to register devices
- Ensures only legitimate users can add devices to the organization

**Protection against device-based attacks:**
- Attackers with compromised credentials cannot easily register devices
- Reduces risk of malicious devices being added to the directory
- Prevents attackers from using registered devices to bypass security controls
- Protects against attacks that rely on device trust

**Defense in depth:**
- Adds additional authentication factor for a sensitive operation
- Complements other device security controls
- Provides audit trail of authenticated device registrations
- Reduces attack surface for device-based compromise

**Compliance and governance:**
- Demonstrates due diligence in device lifecycle management
- Helps meet compliance requirements for device security
- Provides stronger assurance of device ownership
- Better audit trail for device registration events

**Note on Conditional Access:**
For organizations with Azure AD Premium P1/P2 licenses, Conditional Access policies offer more granular control than the Per-User MFA setting. You can create a Conditional Access policy that requires MFA specifically for device registration, along with other conditions.

## Audit

**From Azure Portal:**

1. From Azure Home open the portal menu in the top left, and select `Microsoft Entra ID`
2. Select `Devices`
3. Select `Device settings`
4. Check the setting for `Require Multi-Factor Authentication to register or join devices with Microsoft Entra ID`
5. Verify that it is set to `Yes`

**Note:** This setting applies to Per-User MFA. If using Conditional Access policies for MFA, verify that a policy exists requiring MFA for device registration.

## Remediation

**From Azure Portal (Per-User MFA Setting):**

1. From Azure Home open the portal menu in the top left, and select `Microsoft Entra ID`
2. Select `Devices`
3. Select `Device settings`
4. Find `Require Multi-Factor Authentication to register or join devices with Microsoft Entra ID`
5. Set this to `Yes`
6. Click `Save`

**Recommended Approach: Using Conditional Access (Requires Azure AD Premium P1/P2):**

For organizations using Conditional Access, create a specific policy:

1. From Azure Home open the portal menu in the top left, and select `Microsoft Entra ID`
2. Select `Security`
3. Select `Conditional Access`
4. Click `+ New policy`
5. Enter a name (e.g., "Require MFA for Device Registration")
6. Under **Assignments**:
   - **Users**: Include `All users` (exclude emergency access accounts)
   - **Cloud apps or actions**:
     - Select `User actions`
     - Check `Register or join devices`
7. Under **Access controls > Grant**:
   - Select `Grant access`
   - Check `Require multi-factor authentication`
8. Set **Enable policy** to `Report-only` initially
9. After validation, set to `On`
10. Click `Create`

**From PowerShell (checking device settings):**

```powershell
Connect-AzureAD
$deviceSettings = Get-AzureADDeviceConfiguration
Write-Host "MFA required for device registration: $($deviceSettings.MultiFactorAuthConfiguration)"
```

**From Microsoft Graph API:**

```bash
# Check device settings
az rest --method GET --uri "https://graph.microsoft.com/v1.0/policies/deviceRegistrationPolicy" --query "multiFactorAuthConfiguration"
```

**Best Practices:**

1. **User preparation:**
   - Ensure users have registered for MFA before enabling this setting
   - Communicate the change to users in advance
   - Provide documentation on device registration process with MFA
   - Offer support during initial rollout

2. **Device registration process:**
   - Test device registration with MFA enabled
   - Document the user experience
   - Provide clear instructions for different device types:
     - Windows (Azure AD Join, Hybrid Join, Register)
     - Mobile devices (iOS, Android)
     - macOS
   - Ensure help desk is prepared

3. **Conditional Access approach (recommended):**
   - More granular control than Per-User MFA
   - Can combine with other conditions (location, device state, etc.)
   - Better reporting and insights
   - Easier to manage exceptions
   - Use Report-only mode before enforcing

4. **Exception handling:**
   - Plan for devices that need to be registered before users have MFA
   - Consider process for new user onboarding
   - Document procedure for emergency device registration
   - Maintain break-glass procedures

5. **Monitoring:**
   - Review device registration events in audit logs
   - Monitor for failed registration attempts
   - Track MFA challenges during device registration
   - Alert on suspicious device registration patterns
   - Review devices registered recently

6. **Combined with other device security controls:**
   - Require devices to be compliant
   - Implement device-based Conditional Access
   - Use Windows Hello for Business
   - Enable BitLocker encryption
   - Deploy mobile device management (MDM)
   - Regular device compliance reviews

7. **Different registration types:**
   Understand the different ways devices can join Entra ID:
   - **Azure AD Join**: Corporate-owned Windows devices
   - **Hybrid Azure AD Join**: On-premises domain-joined devices synced to Entra ID
   - **Azure AD Register**: BYOD devices (Windows, iOS, Android, macOS)

   This setting affects all types of device registration.

## Default Value

By default, MFA may not be required for device registration. Organizations should enable this control, especially if not using Conditional Access policies.

## References

- [What is device identity in Azure Active Directory?](https://docs.microsoft.com/en-us/azure/active-directory/devices/overview)
- [How to manage device identities in Azure AD](https://docs.microsoft.com/en-us/azure/active-directory/devices/device-management-azure-portal)
- [Plan your Azure Active Directory device deployment](https://docs.microsoft.com/en-us/azure/active-directory/devices/plan-device-deployment)
- [Conditional Access: Require MFA for device registration](https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/howto-conditional-access-policy-registration)
- [Azure AD joined devices](https://docs.microsoft.com/en-us/azure/active-directory/devices/concept-azure-ad-join)

