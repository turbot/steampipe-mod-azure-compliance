## Description

Microsoft Entra ID Conditional Access allows an organization to configure Named locations and configure whether those locations are trusted or untrusted. These settings provide organizations the means to specify Geographical locations for use in conditional access policies, or define actual IP addresses and IP ranges and whether or not those IP addresses and/or ranges are trusted by the organization.

## Rationale

Defining trusted locations helps to:
- Reduce false positives in risk-based policies
- Exclude trusted locations from certain policies
- Create policies that restrict access from untrusted locations
- Comply with regulatory requirements for location-based access controls

Organizations should have defined trusted locations (such as all corporate locations or compliant devices) so they can be used in conditional access policies.

## Audit

**From Azure Portal:**

1. From Azure Home open the portal menu in the top left, and select `Microsoft Entra ID`
2. Select `Security`
3. Select `Named locations` under `Conditional Access`
4. Verify that at least one named location is defined
5. For each named location, verify it is configured appropriately as either:
   - Country location
   - IP ranges location (with IP ranges specified)
6. Determine if the location should be marked as trusted

**From Azure CLI:**

```bash
az rest --method GET --uri https://graph.microsoft.com/v1.0/identity/conditionalAccess/namedLocations
```

Ensure that the response includes at least one named location.

## Remediation

**From Azure Portal:**

1. From Azure Home open the portal menu in the top left, and select `Microsoft Entra ID`
2. Select `Security`
3. Select `Named locations` under `Conditional Access`
4. Select `+ Countries location` or `+ IP ranges location`
5. Enter a name for the location
6. For IP ranges location:
   - Specify the IP ranges
   - Check `Mark as trusted location` if appropriate
7. For Countries location:
   - Select the countries
   - Optionally include unknown areas
8. Click `Create`

**From Azure CLI:**

To create a named location with IP ranges:

```bash
az rest --method POST --uri https://graph.microsoft.com/v1.0/identity/conditionalAccess/namedLocations --headers "Content-Type=application/json" --body '{"@odata.type": "#microsoft.graph.ipNamedLocation","displayName":"Corporate Network","isTrusted":true,"ipRanges":[{"@odata.type":"#microsoft.graph.iPv4CidrRange","cidrAddress":"203.0.113.0/24"}]}'
```

## Default Value

By default, no named locations are configured.

## References

- [What is the location condition in Azure Active Directory Conditional Access?](https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/location-condition)
- [Using the location condition in a Conditional Access policy](https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/location-condition)

