## Description

Conditional Access Policies can be used to block access from geographic locations that are deemed out-of-scope for your organization or application. The scope and variables for this policy should be carefully examined and defined.

## Rationale

Organizations can use location-based Conditional Access policies to block access from countries or regions where they do not have a business presence or where access is unlikely to be legitimate. This can help prevent unauthorized access and reduce the attack surface.

For organizations that operate globally, this policy may not be applicable. However, for organizations with a defined geographic presence, blocking access from outside those locations can be an effective security control.

## Audit

**From Azure Portal:**

1. From Azure Home open the portal menu in the top left, and select `Microsoft Entra ID`
2. Select `Security`
3. Select `Conditional Access`
4. Review each policy to determine if an exclusionary geographic policy exists
5. For each policy, click on the policy name and review:
   - **Assignments > Users**: Should include appropriate users or groups
   - **Assignments > Cloud apps or actions**: Should include appropriate apps
   - **Assignments > Conditions > Locations**: Should exclude allowed locations and include all other locations
   - **Access controls > Grant**: Should be set to `Block access`
   - **Enable policy**: Should be `On`

**From PowerShell:**

```powershell
Connect-AzureAD
$policies = Get-AzureADMSConditionalAccessPolicy
foreach ($policy in $policies) {
    if ($policy.Conditions.Locations.IncludeLocations -contains "All" -and
        $policy.Conditions.Locations.ExcludeLocations.Count -gt 0 -and
        $policy.GrantControls.BuiltInControls -contains "Block") {
        Write-Host "Geographic exclusion policy found: $($policy.DisplayName)"
    }
}
```

## Remediation

**From Azure Portal:**

1. From Azure Home open the portal menu in the top left, and select `Microsoft Entra ID`
2. Select `Security`
3. Select `Conditional Access`
4. Click `+ New policy`
5. Enter a name for the policy (e.g., "Block access from untrusted countries")
6. Under **Assignments**:
   - **Users**: Select `All users` or specific users/groups as appropriate
   - **Cloud apps or actions**: Select `All cloud apps` or specific apps
   - **Conditions > Locations**:
     - Configure: `Yes`
     - Include: `Any location`
     - Exclude: Select trusted named locations (countries/regions where your organization operates)
7. Under **Access controls > Grant**:
   - Select `Block access`
8. Set **Enable policy** to `On`
9. Click `Create`

**Important Notes:**
- Test the policy in Report-only mode first to assess impact
- Ensure you exclude trusted locations to avoid blocking legitimate access
- Consider excluding break-glass/emergency access accounts
- This is a broad blocking policy and should be carefully configured

## Default Value

By default, no geographic blocking policies are configured.

## References

- [Conditional Access: Block access by location](https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/howto-conditional-access-policy-location)
- [What is the location condition in Azure Active Directory Conditional Access?](https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/location-condition)

